:PROPERTIES:
:ID:       8D997FDE-D06F-41AF-88AC-E9546FE65127
:END:
#+TITLE: Subnetwork

+ Tag :: [[id:790FB5EF-E3B4-4900-9916-C845182C8844][network]]

[[id:6A3F1F42-0B72-4F52-A4CE-74C06816495C][IP]] 地址由 *网络号* 和 *主机号* 组成，IP 路由时，会先将数据报发送到 *目标网络* 的路由器，然后再由目标网络路由器转发到网络内的主机。

早期，简单将 IP 地址划分为了 A、B、C 三类，各自拥有一定数量的网络号，但随着接入 Internet 的网络越来越多，网络号就变得不够用了，于是就衍生出来了子网的概念。

子网在原来 A、B、C 三类 IP 地址的主机号部分分了几位出来作为子网，剩下的几位主机号，此时，IP 数据报发送方式为：
1. 发送到 A、B、C 三类 IP 地址网络号对应网络的路由器
2. 路由器根据子网掩码确定 IP 所属子网，发送到对应子网路由器
3. 子网路由器将 IP 数据报转发到对应主机

这样一来，一定程度上解决了网络号不足的问题，同时也减小了顶级路由器路由表的大小，提高路由效率。

* 子网掩码
  子网掩码用于确认当前 IP 地址网络号，子网掩码中 1 的个数表名网络号占用的位数，这时，IP 地址可以写成 =255.254.0.0/15= 的形式。

  相关问题：
  + 子网掩码为 255.255.255.255 的作用？

    根据 [[id:9AF8F3A5-805F-4E3A-A870-997EACD6F72F][route table]] 进行路由时，会根据 Longest Prefix Matching 进行匹配，当 mask 为 255.255.255.255 时，就相当于是一个精确匹配条目，只有有对应 IP 地址的这样的记录，
    就只会根据这个条目对应的规则进行路由。

    在存在类似需求时，就可以通过添加 /32 进行精确路由。

* 路由转发
  当路由器同时位于两个不同的网络时，分别拥有两个网络的 IP。其中一个网络的主机发送的包发送到路由器后，可以根据路由表中的条目来判断目标 IP 在哪个网络，并转发到对应网络主机。

  比如两个子网：
  |------------------+---------------+---------------------------------+-----------------|
  | 子网             |          网络 | IP 范围                         |            广播 |
  |------------------+---------------+---------------------------------+-----------------|
  | 192.168.0.0/17   |   192.168.0.0 | 192.168.0.1 - 192.168.127.254   | 192.168.127.255 |
  |------------------+---------------+---------------------------------+-----------------|
  | 192.168.128.0/17 | 192.168.128.0 | 192.168.128.1 - 192.168.225.254 | 192.168.225.255 |
  |------------------+---------------+---------------------------------+-----------------|

  当 192.168.0.1/17 访问 192.168.128.1/17 时，路由器后可以发现两者不在同一网络，会进行转发。

  注意：子网掩码是算的 bit 位前面的，掩码是 0b00000001 时，0-127 & 0b00000001 是一个值，128-225 & 0b00000001 又是一个值。

* 公网和私网划分
  早在 IPv4 规划的时候担心 IP 会有不足的情况，同时为了应付某些企业内部的网络设定，于是私有 IP (Private IP) 就产生了。私有 IP 也分别在 A, B, C 三类当中各保留一段作为私有 IP 网段：
  |------+-----------------------------+-------------------------------|
  | 类别 | IP范围                      | 私有地址范围                  |
  |------+-----------------------------+-------------------------------|
  | A    | 1.0.0.0 ~ 126.255.255.255   | 10.0.0.0 ~ 10.255.255.255     |
  | B    | 128.0.0.0 ~ 191.255.255.255 | 172.16.0.0 ~ 172.31.255.255   |
  | C    | 192.0.0.0 ~ 223.255.255.255 | 192.168.0.0 ~ 192.168.255.255 |
  |------+-----------------------------+-------------------------------|

  参考：
  + [[https://blog.csdn.net/gui951753/article/details/79210535][详解公网 IP 和私网 IP - 小小呆的博客 - CSDN 博客]]

* Library
  + [[https://github.com/netaddr/netaddr/tree/master][netaddr/netaddr: A network address manipulation library for Python]]

